---
title: Знакомство с R (молниеносное и поверхностное)
---

```{css, echo=FALSE}
.spoiler {
  visibility: hidden;
}

.spoiler::before {
  visibility: visible;
  content: "ОТВЕТ (наведите указатель, чтобы увидеть)"
}

.spoiler:hover {
  visibility: visible;
}

.spoiler:hover::before {
  display: none;
}
```

# Организация рабочего пространства

1. Создайте папку, где будут храниться ВСЕ материалы курса. Например:  Мы будем ее называть __рабочей директорией__. В эту папку помещайте ВСЕ файлы с кодом (с расширением .R).
2. Внутри папки `linmodr` создайте папку `data`, где будут храниться все файлы с данными для анализа.

В итоге у вас должно получиться примерно это:

```
C:\linmodr\
C:\linmodr\data\
```

# Настройка RStudio

Все настройки RStudio находятся меню Tools -> Global Options

- Восстановление рабочено пространства из прошлого сеанса --- это лучше отменить, т.к. обычно переменные-призраки очень мешают. На вкладке `General` убираем галочку `Restore .RData into workspace at startup`, и меняем `Save workspace to .RData on exit` - `Never`
- Перенос длинных строк в окне кода --- это удобно. На вкладке `Code` ставим галочку рядом с опцией `Soft-wrap R source files`
- Источник для установки пакетов. На вкладке `Packages` выбираем подходящее зеркало сайта CRAN (`CRAN mirror`)

# Комментарии

Комментарии в текстах программ обозначаются символом #

```{r}
# это комментарии, они не будут выполняться
```

# Полезные клавиатурные сокращения в RStudio

- `Ctrl + Shift + C` - закомментировать/раскомментировать выделенный фрагмент кода
- `Ctrl + Enter` - отправляет строку из текстового редактора в консоль, а если выделить несколько строк, то будет выполнен этот фрагмент кода.
- `Tab` или `Ctrl + Space` - нажмите после того как начали набирать название функции или переменной, и появится список автоподстановки. Это помогает печатать код быстро и с меньшим количеством ошибок.

# R как калькулятор, математические операции

Математические операторы `+ - / * ^`

```{r}
2 + 2
1024 / 2
1:10
34 * 4
2 ^ 4
```

Для некоторых операций в R есть функции, например:

```{r}
sqrt(27)
log(100)
log10(100)
```

# Как получить помощь

1. В RStudio можно поставить курсор на слово `sqrt` и нажать `F1`
2. Перед названием функции можно напечатать знак вопроса и выполнить эту строку
`?sqrt`
3. Можно воспользоваться функцией `help()`

```{r eval=FALSE}
help("sqrt")
```

#### Задание 1

Найдите длину гипотенузы прямоугольного треугольника со сторонами 3 и 5 см.

<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

#### Задание 2

Поэкспериментируйте с другими математическими операторами (+ - / * ^).

<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

# Переменные

Переменные - это "контейнеры" для числовых (и разных других) значений.

Имена переменных могут содержать латинские буквы обоих регистров, символы точки . и подчеркивания _ , а так же цифры. Имена переменных должны начинаться с латинских букв. Создавайте понятные и "говорящие" имена переменных.

Оператор присваивания это символ стрелочки `<-`. Он работает справа налево, это значит, что значение выражения в его правой части присваивается объекту в левой части.

Создаем переменную a и присваиваем ей значение 2, и переменную b со значением 5:

```{r}
a <- 2
b <- 5
```

Переменные можно вызвать по имени:

```{r}
a
b
```

С переменными можно проводить разные операции

```{r}
a ^ b
a * 3 + sqrt(9) / b
```

Как выбрать название переменной?

- `a` - плохо, и даже `b`, или `х`. Но в некоторых случаях допустимо:)
- `var1` - плохо, но уже лучше
- `var_1` - плохо, но уже лучше
- `shelllength` - говорящее, но плохо читается
- `shell_length`, `wing_colour` или `leg_num` - хорошие говорящие и читабельные названия

Переменные можно использовать только после того, как они были созданы.

Пример 1

```{r eval=FALSE}
box_weight <- 1.5
apples <- 6
box / apples # ошибка. переменная box еще не была создана.
# нужная переменная называется box_weight.
```

Пример 2

```{r eval=FALSE}
box <- 1.3
box / fruits # ошибка. переменная fruits еще не была создана.
fruits <- 7
```

#### Задание 3

Переставьте строки так, чтобы код можно было выполнить без ошибки.

```{r eval=FALSE}
distance <- 149
speed <- distance / time
time <- 5
```

<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

#### Задание 4

Представьте прямоугольник. Его ширина 3 см, а длина на 5 см больше. Чему равен периметр? (В решении используйте переменные).

<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

# Структуры данных

Данные в R можно хранить в виде разных объектов.

В результате выполнения следующих команд числа. Одно выражение - одно значение.

```{r}
23
sqrt(25)
```

На самом деле, эти величины - просто векторы единичной длины

Сначала разберемся с векторами, а другие структуры данных (датафреймы, списки, матрицы) будем изучать по мере знакомства с R .

# Векторы

_Вектор_ - один объект, внутри которого несколько значений.

## Создание и работа с векторами

- Оператор `:` (двоеточие) используется для создания векторов, где значения следуют одно за другим с шагом 1 без пропусков.

```{r}
1:10 # от одного до 10
-5:3 # от -5 до 3
```

#### Задание 5

Создайте вектор из целых чисел от 1 до 100. Как вы думаете, что означают номера в квадратных скобках в начале каждой строки?

<div class="spoiler">
```{r purl=FALSE}
1:100
```
</div>

- Функция `c()` - от англ. concatenate. Следите, чтобы было английское си, а не русское эс:).

```{r eval=FALSE}
?c # посмотрите хелп к функции
```

Функция `c` принимает несколько (произвольное количество) аргументов, разделенных запятыми. Она собирает из них вектор.

```{r}
c(2, 4, 6)
c(-9.3, 0, 2.17, 21.3)
```

#### Задание 6

Создайте вектор, в котором будет три наименьших отрицательных простых числа в порядке возрастания.

<div class="spoiler">
```{r purl=FALSE}
c(-5, -3, -1)
```
</div>

- Функция `seq()` создает последовательности с заданным шагом или заданной длины.

```{r}
seq(from = 1, to = 5, by = 0.5)
```

#### Задание 7

Посмотрите в справку к функции `seq()` и выясните, как создавать последовательности заданной длины.
Создайте последовательность от -1 до 1 из 9 элементов.

<div class="spoiler">
```{r purl=FALSE}
seq(from = -1, to = 1, length.out = 9)
```
</div>

Векторы можно хранить в переменных для последующего использования

```{r}
my_num <- 1:12 # численный вектор от -11 до 12 сохранен в переменной my_num
my_num
my_num_1 <- c(100, 200, 300, 400) # численный вектор, сохранен в переменной my_num_1
my_num_1
my_num_2 <- c(1.3, 1.7, 1.2, 0.4)
my_num_2
```

#### Задание 8

Создайте вектор `nums`, в котором сначала следуют все элементы вектора `my_num`, а затем все элементы вектора `my_num_1`

<div class="spoiler">
```{r purl=FALSE}
# Вариант 1. Можно просто перечислить все элементы
nums <- c(1:12, 1.3, 1.7, 1.2, 0.4)
# Вариант 2. Можно использовать сами векторы
nums <- c(my_num, my_num_1)
nums
```
</div>


### Векторизованные операции

```{r}
# Создадим переменную, для хранения вектора
v1 <- 1:9
v1 # так можно посмотреть, что у нее внутри
# С векторами можно делать множество операций - это удобно
v1 + 5
v1 / 2
2 / v1
```

## Адресация внутри векторов

При помощи оператора `[]`, можно обратится к элементам вектора. 
В квадратных скобках вам нужно указать вектор из одного или нескольких порядковых номеров элементов.

```{r}
nums[1] # первый элемент в векторе nums
nums[10] # 10-й элемент
nums[16]
```

Если вам нужно несколько элементов, то их нужно передать квадратным скобкам в виде вектора. Например, если мы напишем в квадратных скобках вектор, который содержит значения 3, 4 и 5, то добудем элементы с такими порядковыми номерами.

```{r}
nums[3:5]
```

Аналогично, если вам нужны элементы не подряд, то передайте вектор с номерами элементов, который вы создали при помощи функции `c()`
`c(2, 4, 6)` # это вектор содержащий 2, 4 и 6, поэтому

```{r}
nums[c(2, 4, 6)] # возвращает 2-й, 4-й и 6-й элементы
```

Вектор - одномерный объект. У его элементов только один порядковый номер (индекс). Поэтому при обращении к элементам вектора нужно указывать только одно число или один вектор с адресами, как мы это делали в предыдущих примерах. Но R выдаст ошибку, если при обращении к вектору, вы не создавали вектор, а просто перечислили номера элементов через запятую.

```{r eval=FALSE}
nums[2, 4, 6] # ошибка
```


#### Задание 9

Извлеките из вектора nums элементы:

- с 12 по 15
- 1, 3, и 5
- с 1 по 3 и 16

<div class="spoiler">
```{r purl=FALSE}
# - с 12 по 15
nums[12:15]
# - 1, 3, и 5
nums[c(1, 3, 5)]
# - с 1 по 3 и 16
nums[c(1:3, 16)]
```
</div>

#### Задание 10

Что будет, если в квадратных скобках указать отрицательный индекс элемента?

<div class="spoiler">
```{r purl=FALSE}
# Отрицательные индексы используются для исключения элементов
nums[-1]
nums[c(-2, -5)]
```
</div>

# Встроенные константы в R

Встроенные константы в R: NA, NULL, NAN, Inf

- NA - англ "not available". Когда объект был, но его свойство не измерили или не записали.
- NULL - пусто - просто ничего нет
- NaN - "not a my_number"
- Inf - "infinity" - бесконечность

Если попросили добыть из вектора номер элемента, которого там точно нет, то R выдаст NA, потому, что такого элемента нет.

Теперь посмотрим на встроенные константы в действии.

Создаем новый вектор с пропущенным значением для экспериментов.

```{r}
my_NA <- c(1, 3, NA, 9, 0, 27)
```

Вот так он выглядит:

```{r}
my_NA
```

Что произойдет с NA?

```{r}
my_NA + 2 # останется NA
my_NA * 0 # останется NA
my_NA / 0  # останется NA
```

Но в последнем случае вы увидите 

- Inf при делении чисел на ноль
- NaN при делении нуля на ноль

NaN получится, если взять корень из отрицательного числа

```{r}
sqrt(-1)
```


# Некоторые типы данных в R

## Числовые данные

Только что видели

## Текстовые данные

Каждый текстовый элемент (говорят "строка" - string, character) должен быть окружен кавычками - двойными или одинарными.

```{r}
"это текст"
'это тоже текст'
"2" # это тоже текст
```

Текстовые значения можно объединять в векторы и работать с ними как обычно.

#### Задание 11

Создайте вектор rainbow с названиями цветов радуги.
Добудьте из этого вектора при помощи `[]` элементы 1 и 6.

<div class="spoiler">
```{r purl=FALSE}
rainbow <- c("red", "orange", "yellow", "green", "blue", "violet")
rainbow # Распечатываем весь вектор.
rainbow[c(1, 6)] # Добываем элементы 1 и 6.
```
<div>


## Логические данные

```{r}
TRUE # истина
FALSE # ложь
```

Для ленивых - можно сокращать первыми заглавными буквами. Но лучше так не делать, чтобы читать программы было легче

```{r}
c(T, F)
```

Для проверки условий используются операторы сравнения и сопоставления `==  <  >  <=  >=  %in%`.

Логические операторы используются для объединения результатов нескольких проверок: И - `&`,  ИЛИ - `|`,  НЕ - `!`

```{r}
?Comparison # справка об операторах сравнения
?match      # о сопоставлении
?Logic # Справка о логических операторах
```

Давайте представим, что перед нами несколько чашек с чаем. В них разное число кусков сахара и разная температура. И чай в них черный или зеленый.

```{r}
sugar <- c(1, 3, 0, 2, 3, 4, 1, 0, 5, 0)
temp <- c(40, 50, 22, 22, 53, 41, 35, 47, 55, 52)
tea <- c('B', 'B', 'G', 'B', 'B', 'B', 'G', 'G', 'G', 'B')
# В каких чашках два или меньше кусков сахара?
sugar <= 2
# В каких чашках температура больше 40 градусов?
temp > 40
sum(temp > 40)
which(temp > 40)
# В каких чашках эти условия выполняются одновременно?
(sugar <= 2) & (temp > 40)
```

#### Задание 12 

При помощи логических векторов ответьте на эти вопросы:

- В каких чашках нет сахара?
- В каких чашках холодный чай (меньше 40 градусов)?
- В каких чашках 0, 3 или 5 кусков сахара?
- В каких чашках нет сахара и чай горячий (больше 40 градусов)?

<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

Логические векторы можно использовать в [], чтобы отобрать данные, соответствующие условию.

```{r}
# Какого цвета чай в чашках с температурой > 50 градусов?
tea[temp > 50]
# Какой температуры зеленый чай в этих чашках?
temp[tea == 'G']
```

#### Задание 13

При помощи логических векторов отберите нужные данные:

- цвет чая, в котором нет сахара
- температура чая, в котором три или больше кусков сахара

<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

## Факторы

Факторы - это способ хранения дискретных (=категориальных данных). Например, если вы поймали 10 улиток и посмотрели их цвет. У большого количества улиток небольшое счетное количество возможных цветов.

```{r}
snails <- c("r", "r", "r", "y", "y", "g", "g", "g", "g")
snails # это просто вектор
```

Но цвет "желтый" обозначает одно и то же для каждой из улиток. Поэтому в целях экономии места можно записать цвета этих улиток в виде вектора, в котором численным значениям будут сопоставлены "этикетки" (называются "уровни" - levels) - названия цветов. Мы можем создать "фактор" цвет улиток.

```{r}
f_snails <- factor(snails)
f_snails # это фактор
```

уровни (levels) этого фактора

- 1 - g,
- 2 - r,
- 3 - y

По умолчанию, R назначает порядок уровней по алфавиту. Можно изменить порядок (см. `help("factor")`). Нам это пригодится позже для работы с дискретными переменными.


# Функции в R

Вы уже видели массу функций, их легко узнать по скобкам после ключевого слова. Познакомимся еще с несколькими и научимся писать пользовательские функции. Пользовательские функции позволяют автоматизировать повторяющиеся действия и делают код легко читаемым.

Вот наш вектор

```{r}
nums
```

Длину вектора можно вычислить при помощи функции `length()`

```{r}
length(nums)
```

Сумму элементов вектора при помощи функции `sum()`

```{r}
sum(nums)
```

#### Задание 14

Вычислите среднее значение для вектора `nums`. Вначале попробуйте сделать это "вручную" при помощи функций `length()` и `sum()`. Как вы думаете, как называется функция, которая может это сделать сразу?

<div class="spoiler">
```{r purl=FALSE}
sum(nums)/length(nums)
mean(nums)
```
</div>

Сумма не работает, если в векторе есть `NA`.

```{r}
my_NA
length(my_NA)
sum(my_NA)
```

Чтобы узнать, почему и как это исправить - посмотрите в `help("sum")`. 
Выяснится, что у функции `sum()` есть аргумент `na.rm`, который по умолчанию принимает значение `FALSE`, то есть `NA` не учитываются при подсчете суммы.

Если мы передадим функции `sum` аргумент `na.rm = TRUE`, то получится правильная сумма

```{r}
sum(my_NA, na.rm = TRUE)
```

Та же история с функцией `mean`

```{r}
mean(my_NA, na.rm = TRUE)
```

# Датафреймы

Датафрейм - один из способов хранения табличных данных в R,

Векторы одинаковой длины можно хранить вместе в виде таблицы.

```{r}
# Создадим векторы, чтобы объединить их в датафрейм.
len <- 1:9 # числовой
col <- c(rep("green", 4), rep("red", 5)) # текстовый
wid <- seq(from = 2, by = 2, to = 18) # числовой

# Создаем датафрейм
my_worms <- data.frame(Length = len,
                       Width = wid,
                       Colour = col)
```

```{r}
class(my_worms) # смотрим, действительно датафрейм
my_worms # печать датафрейма
str(my_worms) # просмотр структуры объекта
View(my_worms) # просмотр в RStudio
```

#### Задание 15

Создайте из этих векторов датафрейм под названием `Jedi` с колонками `name`, `homeworld` и `num_starships`.

```{r}
person_name <- c('Luke Skywalker', 'Darth Vader', 'Obi-Wan Kenobi', 'Yoda')
planet_name <- c('Tatooine', 'Tatooine', 'Stewjon', NA)
starships <- c(2, 1, 5, 0)
```


<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

## Навигация внутри датафреймов

У каждой ячейки в датафрейме есть координаты вида `[строка, столбец]`

```{r}
my_worms[2, 3] # вторая строка в 3 столбце
my_worms[2, ] # вторая строка целиком
my_worms[1:9, 2] # строки с 1 по 9 во втором столбце
my_worms[, 2] # второй столбец целиком
```

Переменные можно извлечь при помощи оператора `$` и имени переменной

```{r}
my_worms$Length
my_worms$Width
```

Имена переменных можно использовать и внутри оператора `[]`

```{r}
my_worms[, 'Length']
my_worms[, 'Width']
```


#### Задание 16

Извлеките из датафрейма Jedi

- третью строку
- вектор имен персонажей
- значение в первом столбце четвертой строки


<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>

#### Задание 17

Создайте датафрейм из созданных ранее векторов tea, temp, sugar. При помощи [] (с использованием индексов, имен переменных и логических векторов) извлеките из него следующие данные:

- Строки с чашками без сахара
- Строки с чашками, где 0, 3 или 5 кусков сахара
- Только данные о температуре и количестве сахара
- Цвет чая, в котором нет сахара
- Температура зеленого чая


<div class="spoiler">
```{r purl=FALSE}
# TODO
```
</div>
